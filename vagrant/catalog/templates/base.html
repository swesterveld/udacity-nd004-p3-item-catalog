<!DOCTYPE html>
<html lang="en">
	<head>
        <title>Beer Catalog</title>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script src="https://apis.google.com/js/client:platform.js?onload=start" async defer></script>

        <!-- Own CSS to specify some custom styles -->
		<link rel=stylesheet type=text/css href="{{ url_for('static', filename='styles.css') }}">
	</head>
	<body>
		<div class="container">
            <div class="row" id="header">
                {% block user %}
                <div class="col-md-12">
                    <div class="row">
                <!-- Google Plus sign in -->
                        <div id="signinButton">
                            <span class="g-signin"
                                data-scope="openid email"
                                data-clientid="264350214576-t1sd3hc55nf93u166h157gjm4eaj3su5.apps.googleusercontent.com"
                                data-redirecturi="postmessage"
                                data-accesstype="offline"
                                data-cookiepolicy="single_host_origin"
                                data-callback="signInCallback"
                                data-approvalprompt="force">
                            </span>
                        </div>
                        <div id="result"></div>
                        <script>
                        function signInCallback(authResult) {
                            if( authResult['code']) {
                                // Hide the sign-in button now that the user is authorized
                                $('#signinButton').attr('style', 'display: none');

                                // Send the one-time-use code to the server, if the server responds,
                                // write a 'login successful' message to the web page and then redirect
                                // back to the main page.
                                $.ajax({
                                    type: 'POST',
                                    url: '/connect_google?state={{session['state']}}',
                                    processData: false,
                                    data: authResult['code'],
                                    contentType: 'application/octet-stream; charset=utf-8',
                                    success: function(result) {
                                        // Handle or verify the server response if necessary.
                                        if (result) {
                                            $('#result').html('Login Successful!</br>' + result +
                                                '</br>Redirecting...')
                                            setTimeout(function() {
                                                window.location.href = "/catalog";
                                            }, 4000);
                                        } else if (authResult['error']) {
                                            console.log('There was an error: ' + authResult['error']);
                                        } else {
                                            $('#result').html('Failed to make a server-side call. Check your configuration and console.');
                                        }
                                    }
                                });
                            }
                        }
                        </script>
                        <!-- End Google Plus sign in -->
                    </div>
                </div>
                <div>
                    <a href="{{ url_for('disconnect') }}">Logout</a>
                </div>
                {% endblock user %}
                {% block header %}
                <div>
                    <h1><a href="{{ url_for('showCatalog') }}">Beer Catalog</a></h1>
                </div>
            </div>
            <div class="row">
                {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                    <div class="alert alert-info" role="alert">{{ message }}</div>
                    {% endfor %}
                {% endif %}
                {% endwith %}
                {% endblock header %}
            </div><!-- header -->
            <div class="row" id="content">
                {% block content %}
                {% endblock content %}
            </div><!-- #content -->
        </div><!-- .container -->

        <footer class="footer">
            <div class="container">
                <p class="text-muted">
                    &copy; Copyright 2015 - Carefully Crafted by <a href="http://github.com/swesterveld/">Sil Westerveld</a>
                </p>
            </div>
        </footer>
	</body>
</html>
